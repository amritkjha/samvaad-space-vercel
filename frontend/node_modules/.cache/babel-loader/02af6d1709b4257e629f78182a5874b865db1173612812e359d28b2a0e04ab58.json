{"ast":null,"code":"import axios from'axios';import React,{useEffect,useState}from'react';import io from'socket.io-client';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ChatWindow=_ref=>{let{room,setRoom}=_ref;// const chatSocket = new WebSocket('ws://localhost:8000/ws/chat/new_room/')\nconst[message,setMessage]=useState('');const[messages,setMessages]=useState([]);// const messages = [\n//   {\n//     sender: 'Self',\n//     message: 'Namaste'\n//   },\n//   {\n//     sender: 'Contact',\n//     message: 'Ram Ram'\n//   },\n// ]\nconst socket=io(\"\".concat(window.location.origin));useEffect(()=>{setMessages([]);socket.emit('joinRoom',room);socket.on('chatMessage',message=>{setMessages(prevMessages=>[...prevMessages,message]);});socket.on('previousMessages',previousMessages=>{setMessages(previousMessages);});return()=>{socket.emit('leaveRoom',room);socket.disconnect();};},[room]);const handleMessageSend=e=>{var _e$target,_e$target$message;e.preventDefault();const message=e===null||e===void 0?void 0:(_e$target=e.target)===null||_e$target===void 0?void 0:(_e$target$message=_e$target.message)===null||_e$target$message===void 0?void 0:_e$target$message.value;const newMessage={username:localStorage.getItem('userName'),message,timestamp:new Date()};socket.emit('chatMessage',{room,...newMessage});setMessage('');};const handleMessageChange=e=>{setMessage(e.target.value);};const handleExitCommunity=()=>{const community_id=room;const member_id=localStorage.getItem('userName');axios.post(\"\".concat(window.location.origin,\"/api/community/leave-community\"),{community_id,member_id}).then(res=>{console.log('community left',res);alert(res.data.message);}).catch(error=>{if(error.response.status===400)alert(error.response.data.message);console.log('error',error);});};return/*#__PURE__*/_jsxs(\"div\",{className:\"h-full p-5\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"h-[93%]\",children:[room&&/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(room&&'border-b',\" flex\"),children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-3xl\",role:\"button\",onClick:()=>setRoom(''),children:'<'}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-2xl ms-2\",children:room}),/*#__PURE__*/_jsx(\"button\",{className:\"ms-auto rounded px-3 my-auto bg-[red]\",onClick:handleExitCommunity,children:\"Exit\"})]}),messages===null||messages===void 0?void 0:messages.map(msg=>{return/*#__PURE__*/_jsx(\"div\",{className:\"\".concat((msg===null||msg===void 0?void 0:msg.username)==localStorage.getItem('userName')?\"bg-[red] ml-auto rounded-l-lg\":\"bg-[green] mr-auto rounded-r-lg\",\" w-fit px-2 py-1\"),children:msg.message});})]}),room&&/*#__PURE__*/_jsxs(\"form\",{className:\"flex h-[7%]\",onSubmit:handleMessageSend,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"message\",className:\"sticky w-[81%] md:w-[89%] rounded mx-auto px-2 text-black\",placeholder:\"Enter a message to send\",value:message,onChange:handleMessageChange}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"bg-green-500 w-[15%] md:w-[6%] mx-auto rounded-r-[40%] text-white p-1 text-3xl leading-3\",children:\">\"})]})]});};export default ChatWindow;","map":{"version":3,"names":["axios","React","useEffect","useState","io","jsx","_jsx","jsxs","_jsxs","ChatWindow","_ref","room","setRoom","message","setMessage","messages","setMessages","socket","concat","window","location","origin","emit","on","prevMessages","previousMessages","disconnect","handleMessageSend","e","_e$target","_e$target$message","preventDefault","target","value","newMessage","username","localStorage","getItem","timestamp","Date","handleMessageChange","handleExitCommunity","community_id","member_id","post","then","res","console","log","alert","data","catch","error","response","status","className","children","role","onClick","map","msg","onSubmit","type","name","placeholder","onChange"],"sources":["E:/deployment/backend/frontend/src/pages/ChatPage/ChatWindow.js"],"sourcesContent":["import axios from 'axios'\r\nimport React, { useEffect, useState } from 'react'\r\nimport io from 'socket.io-client'\r\n\r\nconst ChatWindow = ({room, setRoom}) => {\r\n  // const chatSocket = new WebSocket('ws://localhost:8000/ws/chat/new_room/')\r\n  const [message, setMessage] = useState('')\r\n  const [messages, setMessages] = useState([])\r\n  // const messages = [\r\n  //   {\r\n  //     sender: 'Self',\r\n  //     message: 'Namaste'\r\n  //   },\r\n  //   {\r\n  //     sender: 'Contact',\r\n  //     message: 'Ram Ram'\r\n  //   },\r\n  // ]\r\n\r\n  const socket = io(`${window.location.origin}`);\r\n\r\n  useEffect(() => {\r\n    setMessages([]);\r\n    socket.emit('joinRoom', room);\r\n\r\n    socket.on('chatMessage',  (message) => {\r\n      setMessages(prevMessages => [...prevMessages, message]);\r\n    })\r\n      \r\n    socket.on('previousMessages',  (previousMessages) => {\r\n      setMessages(previousMessages);\r\n    })\r\n    return () => {\r\n      socket.emit('leaveRoom', room);\r\n      socket.disconnect()\r\n    }\r\n  }, [room])\r\n\r\n  const handleMessageSend = (e) => {\r\n    e.preventDefault();\r\n    const message = e?.target?.message?.value;\r\n    const newMessage = {\r\n      username: localStorage.getItem('userName'),\r\n      message,\r\n      timestamp: new Date(),\r\n    }\r\n    socket.emit('chatMessage', {room, ...newMessage});\r\n    setMessage('');\r\n  }\r\n\r\n  const handleMessageChange = (e) => {\r\n    setMessage(e.target.value);\r\n  }\r\n\r\n  const handleExitCommunity = () => {\r\n    const community_id = room;\r\n    const member_id = localStorage.getItem('userName');\r\n    axios\r\n        .post(`${window.location.origin}/api/community/leave-community`, {community_id, member_id})\r\n        .then((res) => {\r\n          console.log('community left', res);\r\n          alert(res.data.message);\r\n        })\r\n        .catch((error) => {\r\n          if(error.response.status === 400)alert(error.response.data.message);\r\n          console.log('error', error);\r\n        })\r\n  }\r\n\r\n  return (\r\n    <div className='h-full p-5'>\r\n      <div className='h-[93%]'>\r\n        {room && <div className={`${room && 'border-b'} flex`}>\r\n          <span className='text-3xl' role='button' onClick={()=>setRoom('')}>{'<'}</span><h3 className='text-2xl ms-2'>{room}</h3>\r\n          <button className='ms-auto rounded px-3 my-auto bg-[red]' onClick={handleExitCommunity}>Exit</button>\r\n        </div>}\r\n        {messages?.map((msg)=>{return (<div className={`${msg?.username==localStorage.getItem('userName')?`bg-[red] ml-auto rounded-l-lg`:`bg-[green] mr-auto rounded-r-lg`} w-fit px-2 py-1`}>{msg.message}</div>)})}\r\n      </div>\r\n      {room &&<form className='flex h-[7%]' onSubmit={handleMessageSend}>\r\n        <input type='text' name='message' className='sticky w-[81%] md:w-[89%] rounded mx-auto px-2 text-black' placeholder='Enter a message to send' value={message} onChange={handleMessageChange} />\r\n        <button type='submit' className='bg-green-500 w-[15%] md:w-[6%] mx-auto rounded-r-[40%] text-white p-1 text-3xl leading-3'>&gt;</button>\r\n      </form>}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default ChatWindow\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}